SELECT
	dtbl_students.student_name AS "C781",
	dtbl_students.student_id AS "C782",
	sum(ftbl_attendance.attendance_value)/cast(count(ftbl_attendance.attendance_key) as decimal(18,4)) AS "C920"
FROM
	K12INTEL_DW.FTBL_ATTENDANCE WITH (NOLOCK)
		INNER JOIN K12INTEL_DW.DTBL_STUDENTS WITH (NOLOCK) ON FTBL_ATTENDANCE.STUDENT_KEY = DTBL_STUDENTS.STUDENT_KEY
		INNER JOIN K12INTEL_DW.DTBL_STUDENT_ATTRIBS WITH (NOLOCK) ON DTBL_STUDENTS.STUDENT_ATTRIB_KEY = DTBL_STUDENT_ATTRIBS.STUDENT_ATTRIB_KEY
		INNER JOIN K12INTEL_DW.DTBL_STUDENT_ANNUAL_ATTRIBS WITH (NOLOCK) ON (FTBL_ATTENDANCE.STUDENT_ANNUAL_ATTRIBS_KEY = DTBL_STUDENT_ANNUAL_ATTRIBS.STUDENT_ANNUAL_ATTRIBS_KEY) 
		INNER JOIN K12INTEL_DW.DTBL_SCHOOLS WITH (NOLOCK) ON FTBL_ATTENDANCE.SCHOOL_KEY = DTBL_SCHOOLS.SCHOOL_KEY
		INNER JOIN K12INTEL_DW.DTBL_SCHOOL_DATES WITH (NOLOCK) ON FTBL_ATTENDANCE.SCHOOL_DATES_KEY = DTBL_SCHOOL_DATES.SCHOOL_DATES_KEY
		INNER JOIN K12INTEL_DW.DTBL_CALENDAR_DATES WITH (NOLOCK) ON FTBL_ATTENDANCE.CALENDAR_DATE_KEY = DTBL_CALENDAR_DATES.CALENDAR_DATE_KEY
		INNER JOIN K12INTEL_USERDATA.XTBL_DOMAIN_DECODES DOMAIN_GRADE_CODE WITH (NOLOCK) ON DOMAIN_GRADE_CODE.DOMAIN_NAME = 'GRADE_CODE' AND DOMAIN_GRADE_CODE.DOMAIN_CODE = DTBL_STUDENT_ANNUAL_ATTRIBS.STUDENT_ANNUAL_GRADE_CODE
		
		
WHERE
	(DTBL_SCHOOL_DATES.LOCAL_SCHOOL_YEAR='2018-2019' 
		and 1=1
		--and ftbl_attendance.absence_reason <> '--'
		)
	 AND (domain_grade_code.domain_alternate_decode IN ('P1', 'PK', 'K', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', 'TR'))
	 AND (1=1)
	 AND (1=1)
	 AND (1=1 
		AND 1=1)
	 AND (1=1)
	 AND (dtbl_schools.school_key IN (1, 133, 2, 2509, 41, 4, 1032, 40, 68, 3659, 37, 5, 202, 42, 49, 7, 1043, 3680, 3681, 45, 3677, 10, 69, 12, 3663, 3657, 15, 16, 64, 50, 1041, 47, 52, 17, 19, 62, 21, 67, 33, 1149, 1349, 1599, 1669, 1031, 55, 116, 61, 22, 23, 3656, 35, 36, 1001, 2604, 25, 26, 129, 27, 3661, 3672, 3673, 59, 48, 31, 44, 3662, 3664, 2612))
 GROUP BY
	dtbl_students.student_name,
	dtbl_students.student_id
 ORDER BY
	dtbl_students.student_name,
	dtbl_students.student_id


go


